name: Sync to Enterprise GitHub

on:
  push:
    branches:
      - '**'
  workflow_dispatch:

jobs:
  sync:
    # Only run on the source GitHub repository, not on the enterprise mirror
    if: github.repository == 'dinavinter/remix-of-agent-identity-hub'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Sync to Enterprise Repo
        env:
          ENTERPRISE_TOKEN: ${{ secrets.ENTERPRISE_GITHUB_TOKEN }}
        run: |
          if [ -z "$ENTERPRISE_TOKEN" ]; then
            echo "Error: ENTERPRISE_GITHUB_TOKEN secret is not set."
            echo "Please set the ENTERPRISE_GITHUB_TOKEN secret in the repository settings."
            exit 1
          fi

          # Target Repository URL
          TARGET_REPO="github.tools.sap/AIAM/agent-identity-ias-tenant-view.git"
          TARGET_URL="https://oauth2:$ENTERPRISE_TOKEN@$TARGET_REPO"
          
          echo "Adding enterprise remote..."
          git remote add enterprise "$TARGET_URL"
          
          echo "Syncing branches..."
          # Push all references from origin to enterprise
          git push enterprise "refs/remotes/origin/*:refs/heads/*" --force
          
          echo "Syncing tags..."
          git push enterprise --tags --force
